var se=Object.defineProperty;var ce=(e,t,r)=>t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var b=(e,t,r)=>(ce(e,typeof t!="symbol"?t+"":t,r),r);import{s as le,B as f,j as n,a as p,r as m,b as d,D as V,c as Y,d as _,I as de,T as ue,e as q,f as Q,g as me,o as he,h as ge,t as g,i as k,F as G,L as W,k as $,l as X,S as T,m as fe,n as H,p as pe,q as ye,u as A,v as be,R as Te,w as F,x as E,A as ke,y as De,C as we,z as Ce,E as M,G as xe,H as Se,J as Me,K as ve,M as Ie,N as Re}from"./vendor.1de0f508.js";const Be=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}};Be();function Z(){const e=m.exports.useRef(null),[t,r]=m.exports.useState(!1),[i,o]=m.exports.useState(!1);m.exports.useEffect(()=>{var c;i&&((c=e.current)==null||c.focus(),o(!1))});const a=()=>o(!0);return[t,()=>{t?(r(!1),a()):r(!0)},e,a]}le(f)(({theme:e})=>({backgroundColor:e.palette.mode==="dark"?"#1A2027":"#fff",...e.typography.body2,padding:e.spacing(1),textAlign:"center",color:e.palette.text.secondary}));function ee(e){const t=m.exports.useId(),r=m.exports.useRef(null),i=()=>{e.onOk(r.current.value)},o=()=>{e.onCancel("")};return d(V,{open:e.open,onClose:o,fullWidth:!0,children:[n(Y,{children:e.title}),d(_,{sx:{height:300},children:[n(de,{htmlFor:t,children:e.labelInput}),n(ue,{id:t,fullWidth:!0,autoFocus:!0,type:"text",inputRef:r,defaultValue:e.initialValue})]}),n(q,{sx:{width:"100vw",position:"fixed",bottom:0},children:d(Q,{fullWidth:!0,size:"large",children:[n(p,{onClick:o,children:"Cancel"}),n(p,{onClick:i,children:e.labelConfirm})]})})]})}function Oe(e){const t=()=>{e.onOk("ok")},r=()=>{e.onCancel("cancel")};return d(V,{open:e.open,onClose:r,fullWidth:!0,children:[n(Y,{children:e.title}),n(_,{children:n(me,{children:e.description})}),n(q,{sx:{width:"100vw",position:"fixed",bottom:0},children:d(Q,{fullWidth:!0,size:"large",children:[n(p,{autoFocus:!0,onClick:r,children:"Cancel"}),n(p,{onClick:t,children:e.labelConfirm})]})})]})}function te(e){const[t,r,i]=Z(),o=a=>{e.onOk(a),r()};return t?n(ee,{open:t,title:e.title,labelInput:e.labelInput,labelConfirm:e.labelConfirm,onOk:o,onCancel:r}):n(p,{sx:{width:"100%"},onClick:r,ref:i,children:e.labelOpen})}const Le={clear(){return v(()=>window.localStorage.clear())},getItem(e){return v(()=>window.localStorage.getItem(e))},removeItem(e){return v(()=>window.localStorage.removeItem(e))},setItem(e,t){return v(()=>window.localStorage.setItem(e,t))}};function v(e,...t){try{return Promise.resolve(e(...t))}catch(r){return Promise.reject(r)}}const Pe=(e,t,r={})=>{let{storage:i,jsonify:o=!0,whitelist:a,blacklist:l}=r;if(typeof window<"u"&&typeof window.localStorage<"u"&&(!i||i===window.localStorage)&&(i=Le),!i)return Promise.reject("localStorage (the default storage engine) is not supported in this environment. Please configure a different storage engine via the `storage:` option.");const c=J(a),s=J(l);return he(t,u=>{const h={...u};Object.keys(h).forEach(w=>{a&&!c[w]&&delete h[w],l&&s[w]&&delete h[w]});const P=o?JSON.stringify(h):h;i.setItem(e,P)}),i.getItem(e).then(u=>{const h=Fe(u)?JSON.parse(u):u;!h||ge(t,h)})};function J(e){return e?e.reduce((t,r)=>(t[r]=!0,t),{}):{}}function Fe(e){return typeof e=="string"}function I(e,t,r,i=!1){let o=t.length;if(o==0||!i&&e>r(t[o-1])||i&&e<r(t[0]))return-1;if(o==1||!i&&e<r(t[0]))return 0;if(i&&e>r(t[o-1]))return o-1;--o;let a=0;for(let l=0;l<=t.length;++l){let c=Math.ceil((a+o)/2),s=r(t[c-1]),u=r(t[c]);if(s<=e&&e<=u)return s==e?c-1:u==e?c:i?c-1:c;s<e?a=c:o=c}return-1}const j={counter:0,getId(){return++this.counter,String(this.counter)}};function C(e){let t=new Date(e),[r,i]=t.toISOString().split("T");i=i.substring(0,8);let o="";for(let[l,c]of r.split("-").entries()){let s=Number(c);l===0&&s-1970>0?o=`${s-1970} years, `:l>0&&s-1>0&&(o+=`${s-1} ${l==1?"months":"days"}, `)}let a="";for(let[l,c]of i.split(":").entries()){let s=Number(c);switch(l){case 0:a=`${s}h, `;break;case 1:a+=`${s}m, `;break;case 2:a+=`${s}s`}}return o+a}const y={getCurrentStartDay(){let e=new Date;return e.setHours(0,0,0),e},getCurrentStartWeek(){let e=y.getCurrentStartDay();return e=y.sumDay(e,-e.getDay()),e},getCurrentStartMonth(){let e=y.getCurrentStartDay();return e.setDate(1),e},sumDay(e,t){let r=new Date(e);return r.setDate(e.getDate()+t),r},sumWeek(e,t){let r=new Date(e);return r.setDate(e.getDate()+t*7),r},sumMonth(e,t){let r=new Date(e);return r.setMonth(e.getMonth()+t),r},sumYear(e,t){let r=new Date(e);return r.setFullYear(e.getFullYear()+t),r}},L=g.model("timer",{id:g.identifier,name:g.string,lastDuration:0}).actions(e=>({setName(t){e.name=t},setLastDuration(t){e.lastDuration=t}})),K=g.model("markTime",{time:g.number,timer:g.safeReference(L)}).actions(e=>({setTimer(t){e.timer=t}}));function R(e){return e.time}const z=g.model("board",{id:g.identifier,name:g.string,timers:g.map(L),history:g.array(K),mostRecent:g.array(g.safeReference(L,{acceptsUndefined:!1}))}).views(e=>({get lastMark(){return e.history.at(-1)},getHistoryBetween(t,r){const i=I(t,e.history,R),o=I(r,e.history,R,!0);if(i!==-1&&o!==-1){const a=e.history.slice(i,o+1);if(a.length>0)return a}return[]},getPrevMark(t){const r=I(t,e.history,R,!0);if(r!==-1)return e.history[r]},getNextMark(t){const r=I(t,e.history,R);if(r!==-1)return e.history[r]}})).actions(e=>({setName(t){e.name=t},updateMostRecent(t){e.mostRecent.remove(t),e.mostRecent.push(t)},addTimer(t){e.timers.put(t),this.updateMostRecent(t)},deleteTimer(t){e.timers.delete(t);for(let r=1;r<e.history.length;++r)e.history[r-1].timer===void 0&&(e.history.splice(r,1),--r);e.history.length>0&&e.history[0].timer===void 0&&e.history.splice(0,1)},startTimer(t,r){var o;if(e.lastMark&&e.lastMark.time>r)throw Error("The mark time can't be less than the last mark time");if(e.lastMark){if(t===e.lastMark.timer)return;(o=e.lastMark.timer)==null||o.setLastDuration(r-e.lastMark.time)}const i=K.create({time:r});e.history.push(i),t&&(i.setTimer(t),this.updateMostRecent(t))},stopTimer(t){this.startTimer(void 0,t)},updateTimers(t){for(const r of t)e.timers.put(r)},updateHistory(t){if(t.length==0)return!1;if(e.history.length==0)e.history.replace(t);else if(t.at(-1).time<e.history[0].time)e.history.replace([...t,...e.history]);else if(e.lastMark.time<t[0].time)e.history.replace([...e.history,...t]);else throw Error(`error updating the istory of marks. The specified items are inside the current range of the history. in board ${e.id} name: ${e.name}`);return!0}}));class Ee{getCurrentTime(){return Date.now()}generateUId(){return j.getId()}}class Ne{constructor(t){b(this,"generator");this.generator=t}createBoard(t){return z.create({id:this.generator.generateUId(),name:t})}createTimer(t,r){return L.create({id:this.generator.generateUId(),name:t})}createMarkTime(t,r){return K.create({timer:t.id,time:this.generator.getCurrentTime()})}}const We=g.model({boards:g.map(z),currentBoard:g.safeReference(z)}).actions(e=>({addBoard(t){e.boards.put(t),e.currentBoard=t},deleteBoard(t){e.boards.delete(t)}}));function $e(){const e=new Ne(new Ee),t=We.create(),r=e.createBoard("Personal");return t.addBoard(r),r.addTimer(e.createTimer("Pereceando","")),r.addTimer(e.createTimer("Comiendo","")),r.addTimer(e.createTimer("ejercicio","")),r.addTimer(e.createTimer("durmiendo","")),r.addTimer(e.createTimer("redes sociales","")),r.addTimer(e.createTimer("tertulia","")),r.addTimer(e.createTimer("hablar con amigos","")),{factory:e,store:t}}const{factory:D,store:S}=$e();Pe("Cronos",S);class N{constructor(t,r,i){b(this,"time");b(this,"duration");b(this,"timer");this.time=r,this.timer=t,this.duration=i}setTimer(t){this.timer=t}}class He{constructor(t,r){b(this,"id");b(this,"name");b(this,"lastDuration",0);b(this,"count",0);this.id=t,this.name=r}setName(t){this.name=t}setLastDuration(t){this.lastDuration+=t}addDuration(t){this.lastDuration+=t}addCount(){++this.count}}function re(e,t,r){const i=r.getHistoryBetween(e.getTime(),t.getTime());let o=D.generator.getCurrentTime();o>t.getTime()&&(o=t.getTime());const a=r.getPrevMark(e.getTime());if(a&&a.timer){const s=e.getTime(),u=(i.length>0?i[0].time:o)-s,h=new N(a.timer,s,u);i.unshift(h)}const l=[];for(let s=0;s<i.length-1;++s){const u=i[s];!u.timer||l.push(new N(u.timer,u.time,i[s+1].time-u.time))}const c=i.at(-1);return c&&c.timer&&l.push(new N(c.timer,c.time,o-c.time)),l}function Ae(e,t,r){const i=re(e,t,r),o={};for(const a of i){a.timer.id in o||(o[a.timer.id]=new He(a.timer.id,a.timer.name));const l=a.duration?a.duration:D.generator.getCurrentTime()-a.time;o[a.timer.id].addDuration(l),o[a.timer.id].addCount()}return Object.values(o)}function ne(e,t){e.addTimer(D.createTimer(t,e.id))}function je(e,t){e.deleteTimer(t.id)}function Ke(e,t){e.setName(t)}function ze(e,t,r){const i=D.generator.getCurrentTime();r?e.stopTimer(i):e.startTimer(t,i)}const Ge=k(e=>{const[t,r]=m.exports.useState(C(e.timer.lastDuration));return m.exports.useEffect(()=>{if(e.lastMark){r(C(0));let i=setInterval(()=>e.lastMark&&r(C(Date.now()-e.lastMark)),1e3);return()=>clearInterval(i)}r(C(e.timer.lastDuration))},[e.lastMark]),d(G,{children:[e.timer.name,". ",t]})}),ie=k(e=>{var o,a,l;const{board:t,WrapperTimer:r}=e,i=m.exports.useRef(null);return m.exports.useEffect(()=>{i.current&&(i.current.scrollTop=1e5,console.log("actualizando scroll",j.getId()))}),console.log("construyendo board",j.getId(),t.history.length,(o=t.lastMark)==null?void 0:o.time,(l=(a=t.lastMark)==null?void 0:a.timer)==null?void 0:l.id),n(f,{style:{maxHeight:500,overflow:"auto"},ref:i,children:n(W,{children:t.mostRecent.map(c=>{var u;let s;return t.lastMark&&c.id===((u=t.lastMark.timer)==null?void 0:u.id)&&(s=t.lastMark.time),n($,{sx:{width:"100vw"},children:n(r,{timer:c,lastMark:s,children:n(Ge,{timer:c,lastMark:s})})},c.id)})})})}),Ue=k(e=>{var t;return d(G,{children:[n(X,{}),d(T,{spacing:2,direction:"row",sx:{width:"100%"},children:[((t=e.board.lastMark)==null?void 0:t.timer)&&d(p,{onClick:()=>e.board.stopTimer(D.generator.getCurrentTime()),startIcon:n(fe,{}),children:["stop ",e.board.lastMark.timer.name]}),n(te,{labelOpen:"new timer",title:"new Timer",labelInput:"timer name",labelConfirm:"create",onOk:r=>ne(e.board,r)})]})]})}),Je=k(e=>{const t=r=>d(H,{autoFocus:r.lastMark!==void 0,onClick:()=>ze(e.board,r.timer,r.lastMark),children:[r.lastMark!==void 0&&n(pe,{children:n(ye,{})}),n(A,{children:r.children})]});return n(f,{sx:{width:"100vw",position:"fixed",bottom:0},children:d(T,{spacing:2,children:[n(f,{children:n(ie,{board:e.board,WrapperTimer:t})}),n(Ue,{board:e.board})]})})}),Ve=k(e=>{var r;const t=i=>{const[o,a,l,c]=Z(),[s,u]=m.exports.useState(0),h=()=>{u(0),c()},P=x=>{Ke(i.timer,x),h()},w=x=>{je(e.board,i.timer),h()},U=x=>{x.type==="keydown"&&x.key!=="Escape"||a()};switch(s){case 1:return n(ee,{title:`Rename timer ${i.timer.name}`,labelInput:"Timer name",onCancel:h,labelConfirm:"rename",onOk:P,open:s===1,initialValue:i.timer.name});case 2:return n(Oe,{title:`Delete timer ${i.timer.name}?`,description:`Are you sure to delete the timer ${i.timer.name}? This action will delete this timer and it's related activity. This action can't be undone`,onCancel:h,labelConfirm:`Delete ${i.timer.name}`,onOk:w,open:s===2});default:return d(G,{children:[n(p,{ref:l,onClick:a,children:i.children}),n(be,{open:o,onClick:U,onKeyDown:U,children:d(W,{children:[n($,{disablePadding:!0,children:n(H,{autoFocus:!0,onClick:()=>u(1),children:n(A,{primary:"Rename"})})}),n($,{disablePadding:!0,children:n(H,{onClick:()=>u(2),children:n(A,{primary:"Delete"})})})]})})]})}};return n(f,{sx:{width:"100vw"},children:d(T,{spacing:2,children:[n(f,{style:{maxHeight:500,overflow:"auto",position:"fixed",bottom:35},children:n(W,{style:{},children:n(ie,{board:e.board,WrapperTimer:t})})}),d(f,{style:{maxHeight:25,position:"fixed",bottom:0,width:"100%"},children:[n(X,{}),d(T,{spacing:2,direction:"row",children:[((r=e.board.lastMark)==null?void 0:r.timer)&&n(f,{children:d("button",{onClick:()=>e.board.stopTimer(D.generator.getCurrentTime()),children:["stop ",e.board.lastMark.timer.name]})}),n(f,{children:n(te,{labelOpen:"new timer",title:"new Timer",labelInput:"timer",labelConfirm:"create",onOk:i=>ne(e.board,i)})})]})]})]})})});function Ye(e){const t=e.mark,[r,i]=m.exports.useState(t.duration?t.duration:D.generator.getCurrentTime()-t.time);return m.exports.useEffect(()=>{if(!t.duration){let o=setInterval(()=>i(Date.now()-t.time),1e3);return()=>clearInterval(o)}},[e.mark]),d("tr",{children:[n("td",{children:t.timer.name}),n("td",{children:new Date(t.time).toLocaleTimeString()}),n("td",{children:C(r)})]})}function oe(){const[e,t]=m.exports.useState(y.getCurrentStartDay),[r,i]=m.exports.useState(y.sumDay(e,1));return{startDate:e,endDate:r,setStartDate:t,setEndDate:i}}function ae(e){const t=e.dateRange,[r,i]=m.exports.useState("day"),o=(s,u)=>{const h=s();t.setStartDate(h),t.setEndDate(u(h,1))},a=(s,u)=>{t.setStartDate(s(t.startDate,u)),t.setEndDate(s(t.endDate,u))},l={day:[y.getCurrentStartDay,y.sumDay],week:[y.getCurrentStartWeek,y.sumWeek],month:[y.getCurrentStartMonth,y.sumMonth]};return d("div",{children:[n(Te,{defaultValue:"day",onChange:s=>{const u=s.currentTarget.value;i(u),o(l[u][0],l[u][1])},children:d(T,{direction:"row",children:[n(F,{label:"Day",value:"day",control:n(E,{})}),n(F,{label:"Week",value:"week",control:n(E,{})}),n(F,{label:"Month",value:"month",control:n(E,{})})]})}),d(T,{direction:"row",children:[d(p,{onClick:()=>a(l[r][1],-1),startIcon:n(ke,{}),children:["Prev ",r]}),d(p,{onClick:()=>a(l[r][1],1),endIcon:n(De,{}),children:["Next ",r]})]}),d(p,{children:["from: ",t.startDate.toLocaleDateString(),", to: ",t.endDate.toLocaleDateString()]})]})}function _e(e){return d("table",{children:[d("tr",{children:[n("th",{children:"timer"}),n("th",{children:"date"}),n("th",{children:"Duration"})]}),e.marks.map((t,r)=>n(Ye,{mark:t},r))]})}function qe(e){const[t,r]=m.exports.useState([...e.summary]),[i,o]=m.exports.useState("duration"),a={duration:(c,s)=>c.lastDuration==s.lastDuration?0:c.lastDuration>s.lastDuration?-1:1,count:(c,s)=>c.count==s.count?0:c.count>s.count?-1:1},l=()=>{switch(i){case"duration":r([...e.summary].sort(a.duration));break;case"count":r([...e.summary].sort(a.count));break}};return m.exports.useEffect(()=>{l()},[e.summary]),d("table",{children:[d("tr",{children:[n("th",{children:"timer"}),n("th",{children:n(p,{onClick:()=>o("duration"),children:"Total duration"})}),n("th",{children:n(p,{onClick:()=>o("count"),children:"Count"})})]}),t.map(c=>d("tr",{children:[n("td",{children:c.name}),n("td",{children:C(c.lastDuration)}),n("td",{children:c.count})]},c.id))]})}const Qe=k(e=>{const t=oe();return n(f,{sx:{width:"100vh"},children:d(T,{spacing:2,children:[n(ae,{dateRange:t}),n(_e,{marks:re(t.startDate,t.endDate,e.board)})]})})}),Xe=k(e=>{const t=oe();return n(f,{sx:{width:"100vh"},children:d(T,{spacing:2,children:[n(ae,{dateRange:t}),n(qe,{summary:Ae(t.startDate,t.endDate,e.board)})]})})});function B(e){const{children:t,value:r,index:i,...o}=e;return n("div",{role:"tabpanel",hidden:r!==i,id:`simple-tabpanel-${i}`,"aria-labelledby":`simple-tab-${i}`,...o,children:r===i&&n(f,{children:t})})}function O(e){return{id:`simple-tab-${e}`,"aria-controls":`simple-tabpanel-${e}`}}function Ze(){const[e,t]=m.exports.useState(0);return n("div",{className:"App",children:n(we,{maxWidth:"sm",children:d(f,{sx:{width:"100%"},children:[n(f,{sx:{borderBottom:1,borderColor:"divider",position:"fixed",top:10,maxHeight:20},children:d(Ce,{value:e,onChange:(i,o)=>{t(o)},"aria-label":"basic tabs example",children:[n(M,{label:"stopwatch",...O(0)}),n(M,{label:"edit timers",...O(1)}),n(M,{label:"activity log",...O(2)}),n(M,{label:"Summary",...O(3)})]})}),n(B,{value:e,index:0,children:n(Je,{board:S.currentBoard})}),n(B,{value:e,index:1,children:n(Ve,{board:S.currentBoard})}),n(B,{value:e,index:2,children:n(Qe,{board:S.currentBoard})}),n(B,{value:e,index:3,children:n(Xe,{board:S.currentBoard})})]})})})}const et=xe({palette:{primary:{main:"#556cd6"},secondary:{main:"#19857b"},error:{main:Se.A400}}});Me.createRoot(document.getElementById("root")).render(n(ve.StrictMode,{children:d(Ie,{theme:et,children:[n(Re,{}),n(Ze,{})]})}));
